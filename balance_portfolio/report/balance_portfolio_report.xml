<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Main template for withhold reports -->
    <template id="report_balance_portfolio_document">
        <t t-call="web.external_layout">
            <t t-set="o" t-value="o.with_context(lang=lang)"/>
            <div class="page">
                <center>
                    <h1>Saldo de cartera.</h1>
                    <!-- <span t-field="o.client_id" />  -->
                </center>
                <!-- Invoice & partner information -->
                <div id="informations" class="row pt-3 mt-4 mb-4">
                    <t t-set="partner" t-value="o.client_id"/>
                    <div class="col-auto col-3 mw-100 mb-2" name="balance_portfolio_client">
                        <p class="m-0">
                            <div t-if="partner.name">
                                <strong>Cliente: </strong>
                                <t t-esc="partner.name"/>
                            </div>  
                        </p>
                        <p class="m-0">
                            <div t-if="partner.vat">
                                <strong>RUC/Cédula: </strong>
                                <t t-esc="partner.vat"/>
                            </div> 
                        </p>
                    </div>
                    <div class="col-auto col-3 mw-100 mb-2"  name="balance_portfoli_current_date">
                        <p class="m-0">
                            <div t-if="o.current_date">
                                <strong>Fecha Actual: </strong>
                                <t t-esc="o.current_date"/> 
                            </div>  
                        </p>
                        <p class="m-0">
                            <div t-if="o.total_amount">
                                <strong>Total: </strong>
                                <span t-field="o.total_amount" t-field-options='{"widget": "monetary"}'/> 
                            </div>  
                        </p>
                    </div>
                </div>

                <!-- Withhold lines -->
                <table class="table table-sm " name="balance_portfolio_line_table" style="font-size:12px; vertical-align: middle;">
                    <thead>
                        <tr>
                            <t t-set="colspan" t-value="6"/>
                            <th name="th_description" class="text-start">
                                <span>Documento</span>
                            </th>
                            <th name="th_docnumber" class="text-start">
                                <span>Registro No.</span>
                            </th>
                            <th name="th_date" class="text-start">
                                <span>Fecha de Emisión</span>
                            </th>
                            <th name="th_end_date" class="text-start">
                                <span>Fecha de Vencimiento</span>
                            </th>
                            <th name="th_days" class="text-start">
                                <span>Dias</span>
                            </th>
                            <th name="th_total" class="text-start">
                                <span>Total</span>
                            </th>
                            <th name="th_balance" class="text-start">
                                <span>Saldo</span>
                            </th>
                            <th name="th_quota" class="text-end">
                                <span>Cupo</span>
                            </th>
                            <th name="th_term" class="text-end">
                                <span>Plazo</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody class="balance_portfolio_line_table_tbody" style="vertical-align=middle;">
                        <t t-foreach="o.client_detail_ids" t-as="client_detail_line">
                            <tr style="border-top: 0.5px solid gray !important;">
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.type"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.id_register"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.record_date"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.end_date"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.days"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.total"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.balance"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.quota"/>
                                    </td>
                                    <td style="vertical-align: middle;">
                                        <span t-esc="client_detail_line.term"/>
                                    </td>
                            </tr>
                        </t>
                    </tbody> 
                </table>
            </div>
        </t>
    </template>

    <!-- Report action for Withholds -->
    <!-- <field name="print_report_name">(object._get_report_base_filename())</field>
        <field name="attachment">(object.state == 'posted') and ((object.name or 'WTH').replace('/','_')+'.pdf')</field>
        <field name="attachment_use">True</field> -->
    <record id="balance_portfolio_report" model="ir.actions.report">
        <field name="name">Reporte de cartera</field>
        <field name="model">balance.portfolio</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">balance_portfolio.report_balance_portfolio</field>
        <field name="report_file">balance_portfolio.report_balance_portfolio</field>
        <field name="binding_model_id" ref="balance_portfolio.model_balance_portfolio"/>
        <field name="binding_type">report</field>
    </record>
    
    <!-- Workaround for Studio reports, see odoo/odoo#60660 -->
    <template id="report_balance_portfolio">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="balance_portfolio.report_balance_portfolio_document" t-lang="lang"/>
            </t>
        </t> 
    </template>

</odoo>
